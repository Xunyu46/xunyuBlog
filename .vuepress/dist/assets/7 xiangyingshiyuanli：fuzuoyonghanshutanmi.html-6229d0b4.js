import{_ as t,r as p,o as c,c as o,b as s,d as n,e as i,a}from"./app-48690364.js";const l={},u=a(`<h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h2><p>ä¸Šä¸€å°èŠ‚æˆ‘ä»¬è¯´åˆ°äº† <code>Reactive</code> ä¼šåœ¨ <code>proxy getter</code> çš„æ—¶å€™æ”¶é›† <code>effect</code> ä¾èµ–ï¼Œåœ¨ <code>proxy setter</code> çš„æ—¶å€™è§¦å‘ <code>effect</code> çš„æ‰§è¡Œã€‚é‚£ä¹ˆ <code>effect</code> å‰¯ä½œç”¨å‡½æ•°åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆï¼Ÿä»¥åŠæ˜¯å¦‚ä½•è¢«æ”¶é›†èµ·æ¥çš„å‘¢ï¼Ÿ</p><h2 id="effect" tabindex="-1"><a class="header-anchor" href="#effect" aria-hidden="true">#</a> effect</h2><p>æ‰¾åˆ°æºç ä¸­å…³äº <code>effect</code> éƒ¨åˆ†çš„å®šä¹‰ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">effect</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¦‚æœ fn å·²ç»æ˜¯ä¸€ä¸ª effect å‡½æ•°äº†ï¼Œåˆ™æŒ‡å‘åŸå§‹å‡½æ•°</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">.</span>effect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> fn<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>fn
  <span class="token punctuation">}</span>
  <span class="token comment">// æ„é€  _effect å®ä¾‹</span>
  <span class="token keyword">const</span> _effect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReactiveEffect</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
  
  <span class="token comment">// options åˆå§‹åŒ–</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">extend</span><span class="token punctuation">(</span>_effect<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>scope<span class="token punctuation">)</span> <span class="token function">recordEffectScope</span><span class="token punctuation">(</span>_effect<span class="token punctuation">,</span> options<span class="token punctuation">.</span>scope<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// å¦‚æœ‰ options æˆ–è€… ä¸æ˜¯æ‡’åŠ è½½ï¼Œæ‰§è¡Œ _effect.run()</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options <span class="token operator">||</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _effect<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// è¿”å› _effect.run</span>
  <span class="token keyword">const</span> runner <span class="token operator">=</span> _effect<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_effect<span class="token punctuation">)</span>
  runner<span class="token punctuation">.</span>effect <span class="token operator">=</span> _effect
  <span class="token keyword">return</span> runner
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ª <code>effect</code> å‡½æ•°å†…éƒ¨æ ¸å¿ƒæ˜¯é€šè¿‡ <code>ReactiveEffect</code> ç±»åˆ›å»ºäº†ä¸€ä¸ª <code>_effect</code> å®ä¾‹ï¼Œä»ä»£ç æ¥çœ‹ï¼Œ<code>_effect</code> ä¸ŠåŒ…å«äº†ä¸€ä¸ª <code>run</code> å‡½æ•°ã€‚é»˜è®¤ <code>effect</code> æ˜¯æ²¡æœ‰ä¼ å…¥ <code>options</code> å‚æ•°çš„ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ‰§è¡Œäº† <code>_effect.run()</code>ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œ<code>fn</code> å‡½æ•°æ˜¯åœ¨ <code>effect</code> å‡½æ•°ä¸­çš„ä¸€ä¸ªå…¥å‚ï¼Œæ¯”å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®ä¸Šä¸€å°èŠ‚ï¼Œæˆ‘ä»¬çŸ¥é“å› ä¸ºè¿™é‡Œæˆ‘ä»¬è®¿é—®äº† <code>state.a</code> æ‰€ä»¥æ”¶é›†äº†å‰¯ä½œç”¨å‡½æ•°ï¼Œä½†æ˜¯éœ€è¦çŸ¥é“çš„æ˜¯è¿™é‡Œçš„ <code>effect</code> ä¼ å…¥çš„æ˜¯ä¸€ä¸ª <code>fn</code>ï¼Œæ‰€ä»¥è¦æƒ³è®¿é—® <code>state.a</code> é‚£è¿™ä¸ª <code>fn</code> å¿…é¡»è¦æ‰§è¡Œæ‰å¯ä»¥ã€‚é‚£æ˜¯åœ¨å“ªé‡Œæ‰§è¡Œçš„å‘¢ï¼Ÿæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ <code>ReactiveEffect</code> çš„å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç”¨äºè®°å½•ä½äºå“åº”ä¸Šä¸‹æ–‡ä¸­çš„effectåµŒå¥—å±‚æ¬¡æ•°</span>
<span class="token keyword">let</span> effectTrackDepth <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// äºŒè¿›åˆ¶ä½ï¼Œæ¯ä¸€ä½ç”¨äºæ ‡è¯†å½“å‰effectåµŒå¥—å±‚çº§çš„ä¾èµ–æ”¶é›†çš„å¯ç”¨çŠ¶æ€</span>
<span class="token keyword">export</span> left trackOpBit <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// è¡¨ç¤ºæœ€å¤§æ ‡è®°çš„ä½æ•°</span>
<span class="token keyword">const</span> maxMarkerBits <span class="token operator">=</span> <span class="token number">30</span>

<span class="token comment">// å½“å‰æ´»è·ƒçš„ effect</span>
<span class="token keyword">let</span> activeEffect<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ReactiveEffect</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”¨äºæ ‡è¯†å‰¯ä½œç”¨å‡½æ•°æ˜¯å¦ä½äºå“åº”å¼ä¸Šä¸‹æ–‡ä¸­è¢«æ‰§è¡Œ</span>
  active <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token comment">// å‰¯ä½œç”¨å‡½æ•°æŒæœ‰å®ƒæ‰€åœ¨çš„æ‰€æœ‰ä¾èµ–é›†åˆçš„å¼•ç”¨ï¼Œç”¨äºä»è¿™äº›ä¾èµ–é›†åˆåˆ é™¤è‡ªèº«</span>
  deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// æŒ‡é’ˆä¸ºï¼Œç”¨äºåµŒå¥— effect æ‰§è¡ŒååŠ¨æ€åˆ‡æ¢ activeEffect</span>
  parent <span class="token operator">=</span> <span class="token keyword">undefined</span>
  <span class="token comment">// ...</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è‹¥å½“å‰ ReactiveEffect å¯¹è±¡è„±ç¦»å“åº”å¼ä¸Šä¸‹æ–‡</span>
    <span class="token comment">// é‚£ä¹ˆå…¶å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°è¢«æ‰§è¡Œæ—¶ä¸ä¼šå†æ”¶é›†ä¾èµ–</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ç¼“å­˜æ˜¯å¦éœ€è¦æ”¶é›†ä¾èµ–</span>
    <span class="token keyword">let</span> lastShouldTrack <span class="token operator">=</span> shouldTrack
    
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä¿å­˜ä¸Šä¸€ä¸ª activeEffect åˆ°å½“å‰çš„ parent ä¸Š</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> activeEffect
      <span class="token comment">// activeEffect æŒ‡å‘å½“å‰çš„ effect</span>
      activeEffect <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token comment">// shouldTrack ç½®æˆ true</span>
      shouldTrack <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// å·¦ç§»æ“ä½œç¬¦ &lt;&lt; å°†ç¬¬ä¸€ä¸ªæ“ä½œæ•°å‘å·¦ç§»åŠ¨æŒ‡å®šä½æ•°</span>
      <span class="token comment">// å·¦è¾¹è¶…å‡ºçš„ä½æ•°å°†ä¼šè¢«æ¸…é™¤ï¼Œå³è¾¹å°†ä¼šè¡¥é›¶ã€‚</span>
      <span class="token comment">// trackOpBit æ˜¯åŸºäº 1 å·¦ç§» effectTrackDepth ä½</span>
      trackOpBit <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">++</span>effectTrackDepth
      
      <span class="token comment">// å¦‚æœæœªè¶…è¿‡æœ€å¤§åµŒå¥—å±‚æ•°ï¼Œåˆ™æ‰§è¡Œ initDepMarkers</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>effectTrackDepth <span class="token operator">&lt;=</span> maxMarkerBits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initDepMarkers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">cleanupEffect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// è¿™é‡Œæ‰§è¡Œäº† fn</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>effectTrackDepth <span class="token operator">&lt;=</span> maxMarkerBits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç”¨äºå¯¹æ›¾ç»è·Ÿè¸ªè¿‡ï¼Œä½†æœ¬æ¬¡å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œæ—¶æ²¡æœ‰è·Ÿè¸ªçš„ä¾èµ–é‡‡å–åˆ é™¤æ“ä½œã€‚</span>
        <span class="token comment">// æ–°è·Ÿè¸ªçš„ å’Œ æœ¬è½®è·Ÿè¸ªè¿‡çš„éƒ½ä¼šè¢«ä¿ç•™</span>
        <span class="token function">finalizeDepMarkers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      
      <span class="token comment">// &lt;&lt; --effectTrackDepth å³ç§»åŠ¨ effectTrackDepth ä½</span>
      trackOpBit <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">--</span>effectTrackDepth
      
      <span class="token comment">// è¿”å›ä¸Šä¸ª activeEffect</span>
      activeEffect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent
      <span class="token comment">// è¿”å›ä¸Šä¸ª shouldTrack</span>
      shouldTrack <span class="token operator">=</span> lastShouldTrack
      <span class="token comment">// æƒ…å†µæœ¬æ¬¡çš„ parent æŒ‡å‘</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤§è‡´çœ‹ä¸€çœ¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ <code>ReactiveEffect</code> ä¸­æ˜¯æ‰§è¡Œäº† <code>this.fn()</code> çš„ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº† <code>effect</code> ä¸­çš„å›è°ƒå‡½æ•° <code>fn</code> æ˜¯åœ¨è¿™é‡Œè¢«è°ƒç”¨çš„ã€‚æ¥ä¸‹æ¥è¯¦ç»†ç ”ç©¶ä¸€ä¸‹è¿™ä¸ª <code>ReactiveEffect</code>ã€‚</p><p>ä½†è¿™æ®µä»£ç çœ‹èµ·æ¥ä¸æ˜¯å¾ˆé•¿ï¼Œä½†æ¶‰åŠäº†å¥½å‡ ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬æ¥ä¸€ä¸ªä¸ªçœ‹ã€‚</p><h3 id="_1-parent-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_1-parent-çš„ä½œç”¨" aria-hidden="true">#</a> 1. parent çš„ä½œç”¨</h3><p>ä¸ºä»€ä¹ˆ <code>ReactiveEffect</code> è¦è®¾è®¡ä¸€ä¸ª <code>parent</code> è¿™æ ·ä¸€ä¸ªçœ‹ä¼¼æ²¡å•¥ç”¨çš„å˜é‡æŒ‡é’ˆæ¥å­˜å‚¨ä¸Šä¸€æ¬¡çš„ <code>activeEffect</code> å‘¢ï¼Ÿå¦‚æœæ”¹æˆä¸‹é¢è¿™æ ·ä¸æ˜¯æ›´ç®€å•å—ï¼Ÿ</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// åˆå§‹åŒ–</span>
  shouldTrack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  activeEffect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// é‡ç½®</span>
  shouldTrack <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶å®å¯¹äºä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>

state<span class="token punctuation">.</span>a<span class="token operator">++</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>effect</code> å‡½æ•°å†…è°ƒç”¨ <code>ReactiveEffect</code> å®ä¾‹çš„ <code>run</code> å‡½æ•°ã€‚<code>run</code> å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼ŒæŠŠ <code>activeEffect</code> æŒ‡å‘ <code>this</code>ã€‚ç„¶åæ‰§è¡Œ <code>effect</code> ä¼ å…¥çš„ <code>fn</code> å‡½æ•°ï¼Œå‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™è®¿é—®äº† <code>state.a</code> è§¦å‘äº† <code>getter</code> é’©å­ã€‚å›é¡¾ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„å†…å®¹ï¼Œ<code>getter</code> çš„æ—¶å€™æœ‰è§¦å‘æ·»åŠ  <code>activeEffect</code> çš„åŠŸèƒ½ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// æŠŠ activeEffect æ·»åŠ åˆ° dep ä¸­
dep.add(activeEffect!)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œ <code>activeEffect</code> æ­£æ˜¯è¿™é‡Œçš„ <code>this</code>ã€‚å½“æ‰§è¡Œ <code>state.a++</code> æ—¶ï¼Œè®¿é—®äº†<code>state.a</code> çš„ <code>setter</code>ã€‚ä¸Šä¸€èŠ‚ä¹Ÿè¯´äº†ï¼Œ<code>setter</code> çš„æ‰§è¡Œä¼šè°ƒç”¨ <code>effect.run</code> å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// triggerEffects</span>
effect<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥åˆä¼šæ‰§è¡Œ <code>fn</code>ã€‚</p><p>åˆ°è¿™é‡Œçœ‹ä¼¼å¾ˆå®Œç¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ğŸŒ°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ef1</span>
<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ef2</span>
  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">b: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>state<span class="token punctuation">.</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">a: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>state<span class="token punctuation">.</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

state<span class="token punctuation">.</span>a <span class="token operator">++</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ï¼Œåœ¨ç¬¬ä¸€æ¬¡ <code>effect</code> æ‰§è¡Œçš„æ—¶å€™ï¼Œ<code>activeEffect = ef1</code> ç„¶åå†æ‰§è¡Œå†…éƒ¨çš„ <code>effect</code>ï¼Œ æ­¤æ—¶ <code>activeEffect = ef2</code> ç„¶å <code>ef2</code> æ‰§è¡Œå®Œæˆå›åˆ° <code>ef1</code> å‡½æ•°ä½“å†…ï¼Œæ­¤æ—¶å†è®¿é—® <code>state.a</code> è§¦å‘å¯¹ <code>a</code> çš„ä¾èµ–æ”¶é›†ï¼Œä½†æ”¶é›†åˆ°çš„å´æ˜¯ <code>ef2</code>ã€‚é‚£ä¹ˆæœ€ç»ˆæ‰“å°çš„æ˜¯ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆæ˜æ˜¾ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œæˆ‘ä»¬æœŸæœ›çš„æ˜¯è¾“å‡ºï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ—¶å€™ <code>parent</code> å°±æ’ä¸Šç”¨åœºäº†ï¼Œå½“ä¸º <code>effect</code> åŠ ä¸Š <code>parent</code> å±æ€§åï¼Œæˆ‘ä»¬å†æ¥æ‹ä¸€ä¸‹æ•´ä½“çš„æµç¨‹ã€‚</p><ol><li>æ‰§è¡Œ <code>ef1</code> çš„æ—¶å€™ï¼Œ<code>activeEffect</code> æŒ‡å‘ <code>ef1</code>ï¼Œæ­¤æ—¶ <code>parent</code> æ˜¯ <code>undefined</code>ã€‚</li><li>æ‰§è¡Œ <code>ef1 fn</code> é‡åˆ°äº† <code>ef2</code>ï¼Œè°ƒç”¨ <code>ef2</code> æ­¤æ—¶ <code>ef2</code> çš„ <code>parent</code> æŒ‡å‘ <code>ef1</code>ï¼Œ <code>activeEffect</code> æŒ‡å‘ <code>ef2</code>ã€‚ç„¶åæ‰§è¡Œ <code>ef2 çš„ fn</code>ã€‚</li><li><code>ef2 çš„ fn</code> æ‰§è¡Œçš„æ—¶å€™ï¼Œè®¿é—®äº† <code>state.b</code> ä¾èµ–æ”¶é›† <code>ef2</code>ã€‚æ‰§è¡Œå®Œæˆåï¼Œ<code>activeEffect = this.parent</code> åˆæŠŠ <code>activeEffect</code> æŒ‡å‘äº† <code>ef1</code>ã€‚</li><li>è¿”å› <code>ef1</code> çš„ <code>fn</code> ä½“ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶è®¿é—® <code>state.a</code> ä¾èµ–æ”¶é›† <code>activeEffect</code> ä¸º <code>ef1</code>ã€‚</li><li>è§¦å‘ <code>state.a</code> çš„ <code>setter</code>ï¼Œè°ƒç”¨ <code>a</code> çš„å‰¯ä½œç”¨ <code>ef1</code>ï¼Œä¾æ¬¡æ‰“å°â€¦â€¦</li></ol><p>åˆ°è¿™é‡Œç›¸ä¿¡å„ä½å°ä¼™ä¼´å·²ç»æ¸…æ¥šäº† <code>parent</code> çš„ä½œç”¨äº†ï¼Œé‚£å°±æ˜¯<strong>é€šè¿‡ <code>parent</code> è¿™ä¸ªæ ‡è®°ï¼Œæ¥å›åˆ‡æ¢ <code>activeEffect</code> çš„æŒ‡å‘ï¼Œä»è€Œå®Œæˆå¯¹åµŒå¥— <code>effect</code> çš„æ­£ç¡®çš„ä¾èµ–æ”¶é›†</strong>ã€‚</p><h3 id="_2-ä¾èµ–æ¸…ç†" tabindex="-1"><a class="header-anchor" href="#_2-ä¾èµ–æ¸…ç†" aria-hidden="true">#</a> 2. ä¾èµ–æ¸…ç†</h3><p>åœ¨è¯´ä¾èµ–æ¸…ç†ä¹‹å‰ï¼Œå†æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">show</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>show<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">a: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>state<span class="token punctuation">.</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

state<span class="token punctuation">.</span>a <span class="token operator">++</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span>
  state<span class="token punctuation">.</span>a <span class="token operator">++</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ <code>effect</code> ä¸­å®Œæˆäº†å¯¹ <code>show</code> å’Œ <code>a</code> çš„ä¾èµ–æ”¶é›†ï¼Œç„¶å <code>1s</code> åï¼Œæˆ‘ä»¬æ”¹å˜äº† <code>show</code> çš„çŠ¶æ€ä¸º <code>false</code>ã€‚æ­¤æ—¶ <code>effect</code> å†…çš„å‡½æ•°ä¸­çš„ <code>console.log</code> å°†æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œç„¶åå†è§¦å‘ <code>state.a++</code> çš„åŠ¨ä½œï¼Œè®¿é—® <code>a</code> çš„ <code>getter</code>ï¼Œå¦‚æœæ²¡æœ‰ä¾èµ–æ¸…ç†ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¹‹å‰çš„åšæ³•ï¼Œæµ‹è¯•ä¹Ÿä¼šè§¦å‘ <code>effect.fn</code> çš„æ‰§è¡Œï¼Œä½†è¿™ä¸ªæ‰§è¡Œå…¶å®æ²¡æ„ä¹‰çš„ï¼Œå› ä¸º <code>a</code> å·²ç»æ²¡æœ‰è¢«ä½¿ç”¨äº†ï¼Œæ˜¯ä¸€ä¸ªæ°¸è¿œä¸ä¼šè¢«è®¿é—®åˆ°çš„å˜é‡ï¼Œé€ æˆäº†æ€§èƒ½æµªè´¹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ é™¤ <code>a</code> çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œè®©å®ƒä¸è¦æ‰§è¡Œã€‚</p><p>æ¥ä¸‹æ¥ä¸€èµ·æ¥çœ‹çœ‹ <code>Vue</code> æ˜¯æ€ä¹ˆåšçš„å§ï¼è¿™é‡Œæ¶‰åŠåˆ°çš„å†…å®¹æœ‰ç‚¹å¤šï¼Œæˆ‘ä»¬å…ˆä¸€ä¸ªä¸ªè§£é‡Šï¼Œé¦–å…ˆè¡¥ä¹ ä¸€ä¸‹å…³äº <code>js</code> çš„ä¸€äº›æ“ä½œç¬¦çš„åŸºç¡€çŸ¥è¯†ã€‚</p><p><strong>1. å·¦ç§»ï¼ˆ&lt;&lt;ï¼‰</strong></p><p>å·¦ç§»æ“ä½œç¬¦ (<code>&lt;&lt;</code>)Â å°†ç¬¬ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢æˆ 2 è¿›åˆ¶åå‘å·¦ç§»åŠ¨æŒ‡å®šä½æ•°ï¼Œå·¦è¾¹è¶…å‡ºçš„ä½æ•°å°†ä¼šè¢«æ¸…é™¤ï¼Œå³è¾¹å°†ä¼šè¡¥é›¶ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>         <span class="token comment">// 00000000000000000000000000000001</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 00000000000000000000000000000010</span>
<span class="token comment">// expected output: 2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. ä½æˆ–æ“ä½œï¼ˆ|ï¼‰</strong></p><p>ä½æˆ–æ“ä½œç¬¦ï¼ˆ|ï¼‰ï¼Œ å¦‚æœä¸¤ä½ä¹‹ä¸€ä¸º 1ï¼Œåˆ™è®¾ç½®æ¯ä½ä¸º 1ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        <span class="token comment">// 00000000000000000000000000000101</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token comment">// 00000000000000000000000000000011</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">|</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 00000000000000000000000000000111</span>
<span class="token comment">// expected output: 7</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. æŒ‰ä½ä¸ï¼ˆ&amp;ï¼‰</strong></p><p>æŒ‰ä½ä¸è¿ç®—ç¬¦ (<code>&amp;</code>) åœ¨ä¸¤ä¸ªæ“ä½œæ•°å¯¹åº”çš„äºŒè¿›ä½éƒ½ä¸ºÂ <code>1</code>Â æ—¶ï¼Œè¯¥ä½çš„ç»“æœå€¼æ‰ä¸ºÂ <code>1</code>ï¼Œå¦åˆ™ä¸ºÂ <code>0</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        <span class="token comment">// 00000000000000000000000000000101</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token comment">// 00000000000000000000000000000011</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 00000000000000000000000000000001</span>
<span class="token comment">// expected output: 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>4. æŒ‰ä½éï¼ˆ~ï¼‰</strong></p><p>æŒ‰ä½éè¿ç®—ç¬¦ï¼ˆ~ï¼‰ï¼Œåè½¬æ“ä½œæ•°çš„ä½ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>     <span class="token comment">// 00000000000000000000000000000101</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span>    <span class="token comment">// 11111111111111111111111111111101</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">~</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 11111111111111111111111111111010</span>
<span class="token comment">// expected output: -6</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">~</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 00000000000000000000000000000010</span>
<span class="token comment">// expected output: 2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰äº†è¿™äº›åŸºç¡€çš„çŸ¥è¯†ç‚¹åï¼Œå†æ¥è®¤è¯†å‡ ä¸ªå˜é‡ã€‚</p><p><strong>1. effectTrackDepth</strong></p><p>ç”¨äºè®°å½•ä½äºå“åº”ä¸Šä¸‹æ–‡ä¸­çš„ <code>effect</code> åµŒå¥—å±‚æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º <code>0</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// effectTrackDepth = 0</span>
<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// effectTrackDepth = 1</span>
  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. trackOpBit</strong></p><p>äºŒè¿›åˆ¶ä½ï¼Œæ¯ä¸€ä½ç”¨äºæ ‡è¯†å½“å‰ <code>effect</code> åµŒå¥—å±‚çº§çš„ä¾èµ–æ”¶é›†çš„å¯ç”¨çŠ¶æ€ã€‚é»˜è®¤å€¼ä¸º <code>1</code>ï¼Œå³ <code>00000000000000000000000000000001</code>ã€‚</p><p><strong>3. maxMarkerBits</strong></p><p>è¡¨ç¤ºæœ€å¤§çš„ <code>effect</code> åµŒå¥—çš„å±‚æ¬¡æ•°ï¼Œæœ€å¤§å€¼ä¸º <code>30</code>ã€‚</p><p>å¥½äº†ï¼Œææ‡‚äº†è¿™äº›æ“ä½œç¬¦ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ <code>Vue</code> çš„ä¾èµ–æ¸…ç†æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå…ˆæ¥çœ‹ä¸è¶…è¿‡ <code>maxMarkerBits</code> å±‚çº§æ•°çš„åµŒå¥— <code>effect</code> çš„ä¾èµ–æ”¶é›†çš„è¿‡ç¨‹ï¼Œè¿˜ä»¥ä¸Šé¢é‚£ä¸ª <code>demo</code> ä½œä¸ºç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">show</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>show<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">a: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>state<span class="token punctuation">.</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

state<span class="token punctuation">.</span>a <span class="token operator">++</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span>
  state<span class="token punctuation">.</span>a <span class="token operator">++</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 1</strong>ï¼š<code>run</code> å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œ<code>trackOpBit = 1 &lt;&lt; ++effectTrackDepth</code> è¿™ä¸ªè¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå¾—åˆ° <code>effectTrackDepth = 1</code>ï¼›<code>trackOpBit.toString(2) = 00000000000000000000000000000010</code>ã€‚</p><p><strong>Step 2</strong>ï¼šå› ä¸º <code>effectTrackDepth &lt; maxMarkerBits</code> ï¼Œæ‰€ä»¥æ‰§è¡Œ <code>initDepMarkers</code> å‡½æ•°ï¼Œå› ä¸ºè¿™é‡Œçš„ <code>deps</code> åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¿˜æ˜¯ä¸ªç©ºæ•°ç»„ï¼Œæ‰€ä»¥æ­¤å‡½æ•°æœªæ‰§è¡Œã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initDepMarkers</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deps <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>w <span class="token operator">|=</span> trackOpBit <span class="token comment">// set was tracked</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 3</strong>ï¼šæ‰§è¡Œ <code>this.fn</code> å‡½æ•°ï¼Œå…ˆè®¿é—® <code>state.show</code>ï¼Œè§¦å‘äº† <code>trackEffects</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">trackEffects</span><span class="token punctuation">(</span><span class="token parameter">dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> shouldTrack <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>effectTrackDepth <span class="token operator">&lt;=</span> maxMarkerBits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæœ¬è½®å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å·²ç»è®¿é—®å¹¶æ”¶é›†è¿‡ï¼Œåˆ™ä¸ç”¨å†æ”¶é›†è¯¥ä¾èµ–</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">newTracked</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è®¾ç½® dep.n</span>
      dep<span class="token punctuation">.</span>n <span class="token operator">|=</span> trackOpBit
      shouldTrack <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">wasTracked</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Full cleanup mode.</span>
    shouldTrack <span class="token operator">=</span> <span class="token operator">!</span>dep<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>activeEffect<span class="token operator">!</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldTrack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dep<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activeEffect<span class="token operator">!</span><span class="token punctuation">)</span>
    activeEffect<span class="token operator">!</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œéœ€è¦é¢å¤–äº†è§£ 2 ä¸ªå‡½æ•°ï¼š<code>wasTracked</code>ï¼ˆå·²ç»è¢«æ”¶é›†è¿‡ï¼Œç¼©å†™æ˜¯ <code>w</code>ï¼‰ å’Œ <code>newTracked</code>ï¼ˆæ–°æ”¶é›†çš„ä¾èµ–ï¼Œç¼©å†™æ˜¯ <code>n</code>ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">wasTracked</span> <span class="token operator">=</span> <span class="token parameter">dep</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>dep<span class="token punctuation">.</span>w <span class="token operator">&amp;</span> trackOpBit<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">newTracked</span> <span class="token operator">=</span> <span class="token parameter">dep</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>dep<span class="token punctuation">.</span>n <span class="token operator">&amp;</span> trackOpBit<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿›å…¥ <code>trackEffects</code> æ—¶ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰ä¸º <code>dep.n</code> è¿›è¡Œæˆ–è¿ç®—èµ‹å€¼ï¼Œæ‰€ä»¥ <code>state.show</code> çš„ <code>newTracked = false</code>ï¼Œ<code>wasTracked = false</code>ã€‚</p><p>æ‰€ä»¥è®¡ç®—å¾—åˆ° <code>shouldTrack = true</code>ï¼Œæœ€åå°† <code>activeEffect</code> æ”¶é›†è¿›å…¥ <code>dep</code> ä¸­ï¼ŒåŒæ—¶æ‰§è¡Œäº† <code>activeEffect.deps.push(dep)</code> å°† <code>dep</code> å­˜å…¥äº† <code>activeEffect</code> çš„ <code>deps</code> ä¸­ã€‚ç„¶åè®¿é—® <code>state.a</code> é‡å¤ä¸Šè¿°æ“ä½œã€‚ä¸Šè¿°æ­¥éª¤æ‰§è¡Œå®Œæˆåçš„ <code>activeEffect.deps</code> å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token string-property property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string-property property">&quot;n&quot;</span><span class="token operator">:</span> <span class="token number">00000000000000000000000000000010</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>effect<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string-property property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string-property property">&quot;n&quot;</span><span class="token operator">:</span> <span class="token number">00000000000000000000000000000010</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>effect<span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 4</strong>ï¼šæœ€åæ‰§è¡Œ <code>finalizeDepMarkers</code> å‡½æ•°ï¼Œæ ¹æ®ç¬¬ 3 æ­¥ï¼Œæ­¤æ—¶ <code>effect</code> ä¸­çš„ <code>deps</code> åŒ…å«äº† 2 ä¸ª <code>dep</code>ï¼Œåˆ†åˆ«æ˜¯ <code>state.show</code> å’Œ <code>state.a</code>ã€‚ <code>finalizeDepMarkers</code> å‡½æ•°å†…éƒ¨æ‰§è¡Œäº† <code>wasTracked</code>ï¼ˆå·²ç»è¢«æ”¶é›†è¿‡ï¼Œç¼©å†™æ˜¯ <code>w</code>ï¼‰ å’Œ <code>newTracked</code>ï¼ˆæ–°æ”¶é›†çš„ä¾èµ–ï¼Œç¼©å†™æ˜¯ <code>n</code>ï¼‰ å‡½æ•°ï¼Œå› ä¸º <code>dep.w = 0</code> æ‰€ä»¥ <code>wasTracked = false</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">finalizeDepMarkers</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">effect</span><span class="token operator">:</span> ReactiveEffect</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> deps <span class="token punctuation">}</span> <span class="token operator">=</span> effect
  <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ptr <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> dep <span class="token operator">=</span> deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">wasTracked</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">newTracked</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¼©å°ä¾èµ–é›†åˆçš„å¤§å°</span>
        deps<span class="token punctuation">[</span>ptr<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> dep
      <span class="token punctuation">}</span>
      <span class="token comment">// clear bits</span>
      dep<span class="token punctuation">.</span>w <span class="token operator">&amp;=</span> <span class="token operator">~</span>trackOpBit
      dep<span class="token punctuation">.</span>n <span class="token operator">&amp;=</span> <span class="token operator">~</span>trackOpBit
    <span class="token punctuation">}</span>
    deps<span class="token punctuation">.</span>length <span class="token operator">=</span> ptr
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸º <code>wasTracked = false</code>ï¼Œå› æ­¤ <code>finalizeDepMarkers</code> å¤„ç†åä»ç„¶å°†å‰¯ä½œç”¨å‡½æ•°ä¿ç•™åœ¨è¿™ä¸¤ä¸ªå±æ€§å¯¹åº”çš„ä¾èµ–é›†åˆä¸­ï¼ŒåŒæ—¶æŠŠ <code>dep.w</code> å’Œ <code>dep.n</code> é‡ç½®å› 0ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string-property property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;n&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>effect<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;w&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;n&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>effect<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Step 5</strong>ï¼šå½“æ‰§è¡Œ <code>state.show = false</code> çš„æ—¶å€™ï¼Œè§¦å‘ <code>effect.run</code> çš„æ‰§è¡Œï¼Œæ­¤æ—¶æ‰§è¡Œ <code>initDepMarkers</code> æ—¶ï¼Œå› ä¸ºå·²ç»å­˜åœ¨äº† <code>dep</code>ï¼Œæ‰€ä»¥å…ˆè®¿é—® <code>state.show</code>ã€‚</p><p>å½“æ‰§è¡Œåˆ° <code>trackEffects</code> æ—¶ï¼Œæ­¤æ—¶çš„ <code>newTracked = false</code>ï¼Œæ‰§è¡Œé€»è¾‘å’Œä¹‹å‰ä¸€è‡´ã€‚åªä¸è¿‡å› ä¸º <code>state.show = false</code>ï¼Œæ‰€ä»¥æ²¡æœ‰è§¦å‘ <code>state.a</code> çš„è¿™ä¸€éƒ¨åˆ†é€»è¾‘çš„å¤„ç†ï¼Œæœ€åå¾—åˆ°çš„ç»“æœä¸ºï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;w&quot;</span><span class="token operator">:</span> <span class="token number">00000000000000000000000000000010</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;n&quot;</span><span class="token operator">:</span> <span class="token number">00000000000000000000000000000010</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>effect<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;w&quot;</span><span class="token operator">:</span> <span class="token number">00000000000000000000000000000010</span><span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;n&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>effect<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Step 6</strong>ï¼šæœ€åæ‰§è¡Œ <code>finalizeDepMarkers</code> æ—¶ï¼Œå¦‚ä¸‹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">wasTracked</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">newTracked</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  dep<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºè¿™é‡Œçš„ <code>state.a</code> çš„ <code>wasTracked = true</code> ä¸” <code>newTracked</code> ä¸º <code>false</code>ï¼Œæ‰€ä»¥æ‰§è¡Œäº† <code>dep.delete(effect)</code> å°† <code>effect</code> ä» <code>dep</code> ä¸­è¸¢æ‰ã€‚</p><p><strong>Step 7</strong>ï¼š<code>1s</code> åæ‰§è¡Œ <code>state.a++</code> çš„æ“ä½œï¼Œç”±äº <code>state.a</code> ä¸­æ²¡æœ‰ <code>effect</code> äº†ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ã€‚</p><p><strong>æ€»ç»“</strong>ï¼š <code>Vue</code> åœ¨ç»„ä»¶çš„ <code>effect</code> æ‰§è¡Œä¹‹å‰ï¼Œä¼šæ ¹æ® <code>dep</code> çš„æ”¶é›†æ ‡è®°ä½ <code>w</code> å’Œ <code>n</code> æ¥è¿›è¡Œæ¸…ç†ä¾èµ–ï¼Œåˆ é™¤ä¹‹å‰ <code>state.a</code> æ”¶é›†çš„ <code>effect</code> ä¾èµ–ã€‚è¿™æ ·å½“æˆ‘ä»¬ä¿®æ”¹ <code>state.a</code> æ—¶ï¼Œç”±äºå·²ç»æ²¡æœ‰ä¾èµ–äº†ï¼Œå°±ä¸ä¼šè§¦å‘ <code>effect</code> é‡æ–°æ‰§è¡Œã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†æ›´å®¹æ˜“å¸®åŠ©å°ä¼™ä¼´ä»¬ç†è§£ä¸Šè¿°çš„æµç¨‹ï¼Œæˆ‘ä¹Ÿç²¾å¿ƒåˆ¶ä½œäº†ä¸€ä¸ªåŠ¨ç”»æ¼”ç¤ºä¸Šè¿°æµç¨‹å’Œè¿‡ç¨‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3cae5ea3287044dbabe2e2b400eb40c6~tplv-k3u1fbpfcp-watermark.image?" alt="ä¾èµ–æ¸…ç†è¿‡ç¨‹.gif"></p>`,81),d=s("code",null,"effectTrackDepth",-1),r=s("code",null,"30",-1),k=s("code",null,"cleanup",-1),v=s("code",null,"cleanup",-1),m=s("code",null,"dep",-1),f=s("code",null,"Vue 3.2",-1),b={href:"https://github.com/vuejs/core/pull/4017",target:"_blank",rel:"noopener noreferrer"},g=a('<h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šè®²å®Œäº† <code>Vue 3</code> çš„å“åº”å¼åŸç†åŸºç¡€ï¼Œå¦‚æœæœ‰å°ä¼™ä¼´äº†è§£ <code>Vue 2</code> çš„å“åº”å¼åŸç†ï¼Œåº”è¯¥æ¸…æ¥š <code>Vue2</code> çš„å“åº”å¼åŸç†å¯ä»¥ç†è§£æˆå¦‚ä¸‹ä¸€å¹…å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d27092e7846c4a47909cbba07b852799~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>åœ¨ <code>Vue 2</code> ä¸­ï¼Œ<code>Watcher</code> å°±æ˜¯ä¾èµ–ï¼Œæœ‰ä¸“é—¨é’ˆå¯¹ç»„ä»¶æ¸²æŸ“çš„ <code>render watcher</code>ã€‚</p><ol><li>ä¾èµ–æ”¶é›†ï¼šç»„ä»¶åœ¨ <code>render</code> çš„æ—¶å€™ä¼šè®¿é—®æ¨¡æ¿ä¸­çš„æ•°æ®ï¼Œè§¦å‘ <code>getter</code> æŠŠ <code>watcher</code> ä½œä¸ºä¾èµ–æ”¶é›†ã€‚</li><li>è§¦å‘æ¸²æŸ“ï¼šå½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šè§¦å‘ <code>setter</code>ï¼Œé€šçŸ¥ <code>watcher</code> æ›´æ–°ï¼Œè¿›è€Œè§¦å‘äº†ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</li></ol><p>ç›¸åº”åœ°ï¼Œåœ¨ <code>Vue 3</code> ä¸­çš„å“åº”å¼æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9dd98a0d60447b3bcde4df4facb00af~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Vue 3</code> ç›¸å¯¹äº <code>Vue 2</code> çš„å“åº”å¼å·®åˆ«ä¸å¤§ï¼Œä¸»è¦å°±æ˜¯åŠ«æŒæ•°æ®çš„æ–¹å¼æ”¹æˆç”¨ <code>Proxy</code> å®ç°ï¼Œä»¥åŠæ”¶é›†çš„ä¾èµ–ç”± <code>watcher</code> å®ä¾‹å˜æˆäº†ç»„ä»¶å‰¯ä½œç”¨å‡½æ•° <code>effect</code>ã€‚å¦å¤–ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ <code>Vue 3</code> åœ¨å“åº”å¼è®¾è®¡ä¸Šåˆå¤šè€ƒè™‘äº†å±‚çº§åµŒå¥—çš„ä¾èµ–æ”¶é›†é—®é¢˜å’Œä¸å¿…è¦çš„ä¾èµ–æ¸…ç†é—®é¢˜ã€‚</p>',8);function y(h,w){const e=p("ExternalLinkIcon");return c(),o("div",null,[u,s("blockquote",null,[s("p",null,[n("æ³¨æ„ï¼Œå½“ "),d,n(" å¤§äº "),r,n(" æ—¶ï¼Œä¼šè°ƒç”¨ "),k,n(" æ¥æ¸…ç†ä¾èµ–ï¼Œå…¶å® "),v,n(" çš„åŸç†å°±æ˜¯ä¾èµ–æ”¶é›†å‰å…¨éƒ¨åˆ é™¤æ‰€æœ‰çš„ "),m,n("ï¼Œä¾èµ–æ”¶é›†æ—¶å†ä¸€ä¸ªä¸ªåŠ è¿›æ¥ï¼Œè¿™ä¸ªæ€§èƒ½å…¶å®æ˜¯æ¯”è¾ƒå·®çš„ï¼Œæ‰€ä»¥ "),f,n(" æ”¹æˆäº†é€šè¿‡äºŒè¿›åˆ¶æ ‡è®°ä½çš„æ–¹å¼æ¥é€‰æ‹©æ€§åˆ é™¤å’Œæ·»åŠ ï¼Œæå‡äº†æ€§èƒ½ã€‚å…³äºè¿™éƒ¨åˆ†æ›´å¤šçš„ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒ"),s("a",b,[n("è¿™ä¸ªPR"),i(e)]),n("ã€‚")])]),g])}const x=t(l,[["render",y],["__file","7 xiangyingshiyuanliï¼šfuzuoyonghanshutanmi.html.vue"]]);export{x as default};
